/*! rwd - Author: Joaquin Marti - 2012  Dual MIT/BSD license */
/*! Javascript helper for responsive design */
(function(window,undefined){"use strict";var document=window.document;var mq=[];var activeBreakpoint;var rpictures=[];var codeBlocks=[];var breakpoints={get:function(){var stylesheets=document.getElementsByTagName('link');for(var i=0,length=stylesheets.length;i<length;i++){if(stylesheets[i].getAttribute('data-name')){mq.push({'name':stylesheets[i].getAttribute('data-name'),'media':stylesheets[i].getAttribute('media')})}}},setActive:function(){for(var i=0,length=mq.length;i<length;i++){if(window.matchMedia(mq[i].media).matches){if(activeBreakpoint!==mq[i].name){activeBreakpoint=mq[i].name;events.breakpointChange()}}}},getMedia:function(name){for(var i=0,length=mq.length;i<length;i++){if(name===mq[i].name){return mq[i].media}}}};var events={bind:function(){window.addEventListener('resize',function(){breakpoints.setActive();picture.refresh()})},breakpointChange:function(){code.execute()}};var picture={process:function(rpicture){var source,src,pr,oSrc;source=picture.getActiveSource(rpicture.element);oSrc=picture.getCurrentSrc(source);src=oSrc.src;pr=oSrc.pr;if(picture.testUpdateSrc(rpicture.element,src)){rpicture.callback.before.call();picture.render(rpicture,src,pr);rpicture.callback.after.call()}},render:function(rpicture,src,pr){var element=rpicture.element;var img=element.getElementsByTagName('img')[0];if(!img){img=document.createElement('img');img.alt=element.getAttribute('alt');element.appendChild(img)}img.onload=function(){var clonedImage=new Image();clonedImage.src=src;img.width=clonedImage.width/pr;img.height=clonedImage.height/pr;if(!rpicture.executed){rpicture.callback.loadonce.call();rpicture.executed=true}rpicture.callback.load.call()};img.src=src},refresh:function(){for(var i=0,length=rpictures.length;i<length;i++){picture.process(rpictures[i])}},testUpdateSrc:function(element,src){var img=element.getElementsByTagName('img')[0];var currentSrc=(img)?img.getAttribute('src'):'';if(src!==currentSrc){return true}return false},getActiveSource:function(element){var sources=picture.getSources(element);var media;for(var i=0,length=sources.length;i<length;i++){media=sources[i].getAttribute('media')||breakpoints.getMedia(sources[i].getAttribute('data-media'));if(media&&window.matchMedia&&window.matchMedia(media).matches){return sources[i]}}},getSources:function(element){return element.getElementsByTagName('source')},getCurrentSrc:function(source){var srcset=source.getAttribute('srcset');if(srcset){var pixelratio=window.devicePixelRatio||1;var sources=srcset.split(',');for(var i=sources.length-1;i>=0;i--){var srcsetParts=helper.trim(sources[i]).split(' ');var imagePr=parseFloat(srcsetParts[1],10);if(pixelratio>=imagePr){return{src:srcsetParts[0],pr:pixelratio}}}}else{return{src:source.getAttribute('src'),pr:1}}}};var code={execute:function(){for(var media in codeBlocks){if(codeBlocks.hasOwnProperty(media)){code.executeOne(media)}}},executeOne:function(media){var mediaQuery=breakpoints.getMedia(media);if(window.matchMedia(mediaQuery).matches){for(var i=0,length=codeBlocks[media].match.length;i<length;i++){codeBlocks[media].match[i].call()}}else{for(var n=0,nlength=codeBlocks[media].unmatch.length;n<nlength;n++){codeBlocks[media].unmatch[n].call()}}}};var test={nativePicture:function(){if(!!(document.createElement('picture')&&document.createElement('source')&&window.HTMLPictureElement)){return true}return false},isPictureElement:function(o){return(typeof HTMLElement==='object'?o instanceof HTMLElement&&o.tagName==='PICTURE':o&&typeof o==='object'&&o.nodeType===1&&typeof o.nodeName==='string'&&o.tagName==='PICTURE')},isFunction:function(o){if(typeof(o)==="function"){return true}else{return false}}};var helper={merge:function(ob1,ob2){for(var key in ob2){if(ob2.hasOwnProperty(key)){ob1[key]=ob2[key]}}return ob1},trim:function(string){return string.replace(/^\s\s*/,'').replace(/\s\s*$/,'')}};var rwd=(function(){var core={init:function(){breakpoints.get();breakpoints.setActive();events.bind()},getBreakpoint:function(){return activeBreakpoint},nativePicture:test.NativePicture,picture:function(elements,options){var rpicture;if(test.nativePicture()){return}for(var i=0,length=elements.length;i<length;i++){if(test.isPictureElement(elements[i])){rpicture={'element':elements[i],'callback':{'before':options.before,'after':options.after,'load':options.load,'loadonce':options.loadonce},'executed':false};rpictures.push(rpicture);picture.process(rpictures[rpictures.length-1])}}},register:function(media,callbacks){if(!codeBlocks[media]){codeBlocks[media]=[];codeBlocks[media].match=[];codeBlocks[media].unmatch=[]}if(callbacks.match&&test.isFunction(callbacks.match)){codeBlocks[media].match.push(callbacks.match)}if(callbacks.unmatch&&test.isFunction(callbacks.unmatch)){codeBlocks[media].unmatch.push(callbacks.unmatch)}code.executeOne(media)}};return core})();window.rwd=rwd})(window);rwd.init();